!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=14)}({0:function(t,e,r){"use strict";function n(t,e,r,n,o,i,s,a){var c,u="function"==typeof t?t.options:t;if(e&&(u.render=e,u.staticRenderFns=r,u._compiled=!0),n&&(u.functional=!0),i&&(u._scopeId="data-v-"+i),s?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=c):o&&(c=a?function(){o.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:o),c)if(u.functional){u._injectStyles=c;var l=u.render;u.render=function(t,e){return c.call(e),l(t,e)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,c):[c]}return{exports:t,options:u}}r.d(e,"a",(function(){return n}))},14:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"wcus-settings wcus-settings--full"},[e("div",{staticClass:"wcus-settings__header"},[e("h1",{staticClass:"wcus-settings__title"},[this._v(this._s(this.$t("page_heading")))])]),this._v(" "),e("div",{staticClass:"wcus-settings__content"},[e("toolbar"),this._v(" "),e("order-list")],1)])};n._withStripped=!0;var o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"wcus-orders-toolbar"},[t.ordersWithoutTTNSelected||t.ordersWithTTNSelected?r("div",{staticClass:"wcus-orders-toolbar__buttons"},[t.ordersWithoutTTNSelected?r("button",{staticClass:"wcus-btn wcus-btn--primary wcus-btn--md",on:{click:function(e){return e.preventDefault(),t.createOrdersTTN(e)}}},[t._v(t._s(t.$t("btn_generate_invoice")))]):t._e(),t._v(" "),t.ordersWithTTNSelected?r("button",{staticClass:"wcus-btn wcus-btn--default wcus-btn--md",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.printTTN(e)}}},[t._v(t._s(t.$t("btn_print_invoice")))]):t._e(),t._v(" "),t.ordersWithTTNSelected?r("button",{staticClass:"wcus-btn wcus-btn--danger wcus-btn--md",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.deleteTTN(e)}}},[t._v(t._s(t.$t("btn_delete_invoice")))]):t._e()]):t._e(),t._v(" "),r("div",{staticClass:"wcus-orders-toolbar__filter"},[r("div",{staticClass:"wcus-orders-toolbar__filter-control"},[r("label",{attrs:{for:"wcus-orders-limit"}},[t._v(t._s(t.$t("label_limit")))]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.limit,expression:"limit"}],staticClass:"wcus-form-control",attrs:{id:"wcus-orders-limit"},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.limit=e.target.multiple?r:r[0]}}},[r("option",{attrs:{value:"20"}},[t._v("20")]),t._v(" "),r("option",{attrs:{value:"50"}},[t._v("50")]),t._v(" "),r("option",{attrs:{value:"100"}},[t._v("100")])])]),t._v(" "),r("div",{staticClass:"wcus-orders-toolbar__filter-control"},[r("label",{attrs:{for:"wcus-orders-page"}},[t._v(t._s(t.$t("label_page")))]),t._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:t.page,expression:"page"}],staticClass:"wcus-form-control",attrs:{id:"wcus-orders-page"},on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.page=e.target.multiple?r:r[0]}}},t._l(t.count_pages,(function(e){return r("option",[t._v(t._s(e))])})),0)])])])};o._withStripped=!0;var i={messages:{ru:{page_heading:"Список заказов",text_loading:"Загрузка...",btn_generate_invoice:"Создать накладные",btn_print_invoice:"Распечатать накладные",btn_delete_invoice:"Удалить накладные",label_limit:"Лимит записей",label_page:"Страница",th_order:"Заказ",th_status:"Статус",th_shipping:"Доставка",th_date:"Дата создание",th_total:"Итого",th_invoice:"Экспресс-накладная",row_create_ttn:"Создать накладную",state_queue:"В очереди...",state_deleting:"Удаление..."},ua:{page_heading:"Список замовлень",text_loading:"Завантаження...",btn_generate_invoice:"Створити накладні",btn_print_invoice:"Роздрукувати накладні",btn_delete_invoice:"Видалити накладні",label_limit:"Ліміт записів",label_page:"Сторінка",th_order:"Замовлення",th_status:"Статус",th_shipping:"Доставка",th_date:"Дата створення",th_total:"Загалом",th_invoice:"Експрес-накладна",row_create_ttn:"Створити накладну",state_queue:"У черзі...",state_deleting:"Видалення..."},en:{page_heading:"Order list",text_loading:"Loading...",btn_generate_invoice:"Create invoices",btn_print_invoice:"Print invoices",btn_delete_invoice:"Delete invoices",label_limit:"Limit records",label_page:"Page",th_order:"Order",th_status:"Status",th_shipping:"Shipping",th_date:"Date created",th_total:"Total",th_invoice:"Invoice",row_create_ttn:"Create invoice",state_queue:"Queue...",state_deleting:"Deleting..."}}};function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var u={i18n:i,computed:a(a(a({},WCUkrShipping.UI.mapState("orders",["count_pages"])),WCUkrShipping.UI.mapGetters("orders",["ordersWithTTN","ordersWithoutTTN"])),{},{limit:{get:function(){return this.$store.state.orders.limit},set:function(t){this.$store.state.orders.limit=t,this.loadOrders()}},page:{get:function(){return this.$store.state.orders.page},set:function(t){this.$store.state.orders.page=t,this.loadOrders()}},ordersWithTTNSelected:function(){return this.ordersWithTTN.length>0},ordersWithoutTTNSelected:function(){return this.ordersWithoutTTN.length>0}}),methods:a({},WCUkrShipping.UI.mapActions("orders",["loadOrders","createOrdersTTN","printTTN","deleteTTN"]))},l=r(0),d=Object(l.a)(u,o,[],!1,null,null,null);d.options.__file="src/js/order-list/components/toolbar.vue";var _=d.exports,p=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.loading?r("div",[t._v(t._s(t.$t("text_loading")))]):r("div",{staticClass:"wcus-table-wrap"},[r("table",{staticClass:"wcus-table"},[r("thead",[r("tr",[r("th"),t._v(" "),r("th",[t._v(t._s(t.$t("th_order")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_status")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_shipping")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_date")))]),t._v(" "),r("th",[t._v(t._s(t.$t("th_total")))]),t._v(" "),r("th",{staticClass:"text-center"},[t._v(t._s(t.$t("th_invoice")))])])]),t._v(" "),r("tbody",t._l(t.orders,(function(t){return r("order-row",{key:t.id,attrs:{order:t}})})),1)])])};p._withStripped=!0;var f=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("tr",[r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"selected"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.selected)?t._i(t.selected,null)>-1:t.selected},on:{change:function(e){var r=t.selected,n=e.target,o=!!n.checked;if(Array.isArray(r)){var i=t._i(r,null);n.checked?i<0&&(t.selected=r.concat([null])):i>-1&&(t.selected=r.slice(0,i).concat(r.slice(i+1)))}else t.selected=o}}})]),t._v(" "),r("td",[r("a",{attrs:{href:t.order.edit_url}},[t._v(t._s(t.label))])]),t._v(" "),r("td",[r("div",{staticStyle:{display:"inline-block",padding:"8px",background:"#eee","border-radius":"2px"}},[t._v(t._s(t.order.status))])]),t._v(" "),r("td",[t._v(t._s(t.order.shipping_method))]),t._v(" "),r("td",[t._v(t._s(t.order.created_at))]),t._v(" "),r("td",{domProps:{innerHTML:t._s(t.order.total)}}),t._v(" "),r("td",{staticClass:"text-center"},[t.defaultState?r("div",[t.order.ttn_id?r("span",[t._v(t._s(t.order.ttn_id))]):r("div",[r("a",{attrs:{href:"/wp-admin/admin.php?page=wc_ukr_shipping_ttn&order_id="+t.order.id}},[t._v(t._s(t.$t("row_create_ttn")))])])]):t._e(),t._v(" "),t.queueWaitingState?r("div",{staticStyle:{color:"#aaa"}},[t._v(t._s(t.$t("state_queue")))]):t._e(),t._v(" "),t.deletingState?r("div",{staticStyle:{color:"#f00"}},[t._v(t._s(t.$t("state_deleting")))]):t._e(),t._v(" "),t.errorTTNCreatingState?r("div",{staticStyle:{color:"#f00"}},t._l(t.order.errors,(function(e){return r("div",[t._v(t._s(e))])})),0):t._e()])])};f._withStripped=!0;var v="default",h="waiting",g="deleting",b="error_creating_ttn",m={i18n:i,props:["order"],computed:{label:function(){return"#"+this.order.id+" "+this.order.firstname+" "+this.order.lastname},selected:{get:function(){return this.order.selected},set:function(t){t?this.$store.commit("orders/selectOrder",this.order.id):this.$store.commit("orders/deselectOrder",this.order.id)}},defaultState:function(){return v===this.order.state},queueWaitingState:function(){return h===this.order.state},errorTTNCreatingState:function(){return b===this.order.state},deletingState:function(){return g===this.order.state}}},w=Object(l.a)(m,f,[],!1,null,null,null);function y(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function T(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?y(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function O(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}w.options.__file="src/js/order-list/components/order-row.vue";var S={components:{"order-row":w.exports},i18n:i,computed:T({},WCUkrShipping.UI.mapState("orders",["orders","loading"])),mounted:function(){this.loadOrders()},methods:T({},WCUkrShipping.UI.mapActions("orders",["loadOrders"]))},j=Object(l.a)(S,p,[],!1,null,null,null);j.options.__file="src/js/order-list/components/order-list.vue";var x={components:{toolbar:_,"order-list":j.exports},i18n:i},C=Object(l.a)(x,n,[],!1,null,null,null);C.options.__file="src/js/order-list/components/app.vue";var k=C.exports;function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var N=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$=window.jQuery,this.successHandler=null,this.errorHandler=null,this.responseHandler=null,this.xhr=null}var e,r,n;return e=t,(r=[{key:"success",value:function(t){return this.successHandler=t,this}},{key:"catch",value:function(t){return this.errorHandler=t,this}},{key:"response",value:function(t){return this.responseHandler=t,this}},{key:"abort",value:function(){return this.xhr&&this.xhr.abort(),this}},{key:"post",value:function(t,e){var r=this,n=r.$;return this.xhr=n.ajax({method:"POST",url:wc_ukr_shipping_globals.ajaxUrl,data:Object.assign({action:t,_token:wc_ukr_shipping_globals.nonce},e),dataType:"json",success:function(t){"function"==typeof r.successHandler&&r.successHandler(t)},error:function(t,e,n){"function"==typeof r.errorHandler?r.errorHandler(t,e,n):alert("".concat(t.status," ").concat(t.statusText))},complete:function(){"function"==typeof r.responseHandler&&r.responseHandler()}}),this}}])&&P(e.prototype,r),n&&P(e,n),t}(),$=function(t,e){return window.jQuery||console.error("jQuery not found."),(new N).post(t,e)},W=function(t,e,r){$("wcus_orders_list",{page:t,limit:e}).success((function(t){r(t)})).catch((function(t,e,n){r({success:!1,error:e})}))};function U(t,e,r,n,o,i,s){try{var a=t[i](s),c=a.value}catch(t){return void r(t)}a.done?e(c):Promise.resolve(c).then(n,o)}function E(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function s(t){U(i,n,o,s,a,"next",t)}function a(t){U(i,n,o,s,a,"throw",t)}s(void 0)}))}}var A=function(t){return E(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){$("wcus_generate_ttn",{order_id:t}).success((function(t){e(t)}))})));case 1:case"end":return e.stop()}}),e)})))()},D=function(t){return E(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){$("wcus_ttn_delete",{refs:t}).success((function(t){e(t)}))})));case 1:case"end":return e.stop()}}),e)})))()};function R(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return H(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return s=t.done,t},e:function(t){a=!0,i=t},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function I(t,e,r,n,o,i,s){try{var a=t[i](s),c=a.value}catch(t){return void r(t)}a.done?e(c):Promise.resolve(c).then(n,o)}function q(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function s(t){I(i,n,o,s,a,"next",t)}function a(t){I(i,n,o,s,a,"throw",t)}s(void 0)}))}}var M,Q={state:{orders:[],limit:20,page:1,count_pages:1,loading:!1},getters:{ordersWithTTN:function(t){return t.orders.filter((function(t){return t.selected&&t.ttn_id}))},ordersWithoutTTN:function(t){return t.orders.filter((function(t){return t.selected&&!t.ttn_id}))}},mutations:{selectOrder:function(t,e){for(var r=0;r<t.orders.length;r++)if(t.orders[r].id===e)return void(t.orders[r].selected=!0)},deselectOrder:function(t,e){for(var r=0;r<t.orders.length;r++)if(t.orders[r].id===e)return void(t.orders[r].selected=!1)}},actions:{loadOrders:function(t){t.commit;var e=t.state;e.loading=!0,W(e.page,e.limit,(function(t){t.success&&(e.orders=t.data.orders,e.count_pages=t.data.count_pages),e.loading=!1}))},createOrdersTTN:function(t){return q(regeneratorRuntime.mark((function e(){var r,n,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.commit,(r=t.getters).ordersWithoutTTN.forEach((function(t){t.state=h})),n=R(r.ordersWithoutTTN),e.prev=3,n.s();case 5:if((o=n.n()).done){e.next=13;break}return i=o.value,e.next=9,A(i.id);case 9:(s=e.sent).success?(i.ttn_id=s.data.ttn_id,i.ttn_db_id=s.data.ttn_db_id,i.ttn_ref=s.data.ttn_ref,i.state=v):(i.errors=s.errors,i.state=b);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))()},printTTN:function(t){t.commit;var e=t.getters;window.WCUkrShipping.Printer.open(e.ordersWithTTN.map((function(t){return t.ttn_db_id})))},deleteTTN:function(t){return q(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.commit,(r=t.getters).ordersWithTTN.forEach((function(t){t.state=g})),n=r.ordersWithTTN.map((function(t){return t.ttn_ref})),e.next=5,D(n);case 5:e.sent.success&&r.ordersWithTTN.forEach((function(t){t.ttn_id="",t.ttn_db_id="",t.ttn_ref="",t.state=v}));case 7:case"end":return e.stop()}}),e)})))()}}};WCUkrShipping.UI.registerStore("orders",Q),WCUkrShipping.UI.createApp("#wcus-order-list",{render:function(t){return t(k)}}),(M=jQuery)(".j-wcus-ttn-status").on("click",(function(t){t.preventDefault();var e=M(this);WCUkrShippingRouter.post("wc_ukr_shipping_update_ttn_status",{params:{ttn_id:this.dataset.ttn},success:function(t){t.success?e.prev().html(t.data.status):t.exception&&console.error(t.exception)}})}))}});